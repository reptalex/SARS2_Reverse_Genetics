{
    "collab_server" : "",
    "contents" : "library(ape)\nlibrary(data.table)\nlibrary(ggplot2)\nlibrary(magrittr)\nlibrary(rentrez)\nlibrary(DECIPHER)\nlibrary(muscle)\nlibrary(msa)\nlibrary(seqinr)\nlibrary(ggtree)\nlibrary(xlsx)\nsource('scripts/utils.R')\n\n\n# Papers, accessions, mutations -------------------------------------------\n\n# SARS1-Urbani --> pBAC-SARS-CoV\n# Authors: Albazan et al\n# accn=AY278741\n# Paper https://journals.asm.org/doi/epdf/10.1128/JVI.00385-06?src=getft\n# mutations: used several pre-existing restriction sites:\n# # ClaI 676; MluI 7452; MluI 13886; PmeI 18404; BamHI 26044; NheI 28753\n\n# Bat-SCoV  (assembled from scratch)\n# Authors: Becker et al\n# accn=FJ211859\n# Paper https://www.pnas.org/doi/full/10.1073/pnas.0808116105\n# mutations: used several pre-existing restriction sites:\n# C4385T - BglI site,...\n\n# MERS-CoV\n# Authors: Scobey et al\n# accn=JX869059 cited https://journals.asm.org/doi/10.1128/mBio.00473-12\n# Paper https://journals.asm.org/doi/epdf/10.1128/JVI.00385-06?src=getft\n# mutations: \n# G494C G17713T (remove pre-existing BglI sites)\n# The authors mention adding sites to create the following contiguous DNA chunks\n# MERS A (nucleotides 1–4692), MERS-B (4693–8811), MERS-C (8812–12258), \n# MERS-D1 (12259–15470), MERS-D2 (15471–18806), MERS-E (18807–24397), and MERS-F (24398–30119)\n\n# Sl-CoV WIV1 --> rWIV1\n# Authors: Zeng et al (including Daszak, Zheng-Li)\n# accn=KF367457\n# Paper https://journals.asm.org/doi/10.1128/JVI.03079-15\n# mutations: BglI sites were introduced/removed as follows\n# C1575A; A8028C; T8034C; A10557C; T10563G; A17012C; T17021C; T22463C; A22472C; T27527C\n\ncls <- gg_color_hue(6)\naccns <- c('AY278741','FJ211859','JX869059','KF367457')\n\nnames(accns) <- c('SARS1-Urbani','Bat-SCoV','MERS','WIV1')\n\n# MERS --------------------------------------------------------------------\n\nG_mers <- get_genome(accns['MERS'])\nG2 <- muts(G_mers,\n           locs = c(494,17713),\n           bases=c('C','T'))\n\nR_mers <- digest_genome(SEQ=G_mers,enzymes = 'BglI',fragments=FALSE)\nR_mers$virus <- \"MERS\"\nR2 <- digest_genome(SEQ=G2,enzymes = 'BglI',fragments=FALSE)\nR2$virus <- 'rMERS'\n\nR3 <- rbind(R2,data.table('position'=c(4692,8811,12258,15470,18806,24397),\n                 \"Restriction_Enzyme\"='BglI',\n                 'genome_length'=nchar(G_mers),\n                 'virus'='rMERS'))\n\nMERS <- rbind(R_mers,R3)\nMERS[,rel_position:=position/genome_length]\nMERS[,virus:=factor(virus,levels=c('rMERS','MERS'))]\n\ng_mers_rs=ggplot(MERS,aes(virus,rel_position))+\n  geom_point(cex=5,aes(color=virus))+\n  coord_flip()+\n  geom_hline(yintercept = MERS[virus=='rMERS',rel_position],lty=2)+\n  ggtitle('Restriction Map MERS-->rMERS')+\n  scale_x_discrete(NULL)+\n  scale_y_continuous(name=NULL)+\n  scale_color_manual(values=c(cls[3],'black'))+\n  theme(legend.position='none')\n\n# WIV1 --> rWIV1 ----------------------------------------------------------\n# C1575A; A8028C; T8034C; A10557C; T10563G; A17012C; T17021C; T22463C; A22472C; T27527C\n\nG_WIV1 <- get_genome(accns[4])\nG2 <- muts(G_WIV1,\n           locs=c(1575,8028,8034,10557,10563,17012,17021,22463,22472,27527),\n           bases=c('A','C','C','C','G','C','C','C','C','C'))\n\n\nWIV=digest_genome(SEQ=G_WIV1,enzymes = 'BglI',fragments = FALSE)\nWIV$virus <- 'WIV1'\nrWIV <- digest_genome(SEQ=G2,enzymes = 'BglI',fragments=FALSE)\nrWIV$virus <- 'rWIV1'\n\nWIV <- rbind(WIV,rWIV)\nWIV[,virus:=factor(virus,levels=c('rWIV1','WIV1'))]\nWIV[,rel_position:=position/genome_length]\n\ng_wiv_rs=ggplot(WIV,aes(virus,rel_position))+\n  geom_point(cex=5,aes(color=virus))+\n  coord_flip()+\n  geom_hline(yintercept = WIV[virus=='rWIV1',rel_position],lty=2)+\n  ggtitle('Restriction Map WIV1-->rWIV1')+\n  scale_x_discrete(name=NULL)+\n  scale_y_continuous(name='Genome Position')+\n  scale_color_manual(values=c(cls[1],NA))+\n  theme(legend.position='none')\n\nggarrange(g_mers_rs,g_wiv_rs,nrow=2)\n\n\nmax_rs <- rbind(WIV[,list(max_fragment_length=max(diff(position))/genome_length[1],\n                          no_fragments=.N+1),by=virus],\n                MERS[,list(max_fragment_length=max(diff(position))/genome_length[1],\n                           no_fragments=.N+1),by=virus])\n\nmax_rs[,virus:=factor(virus,levels=c('MERS','rMERS','WIV1','rWIV1'))]\n\n# Include on L(n) plot ----------------------------------------------------\nload('data/CoV_restriction_mapping_workspace.Rd')\n\ng_Ln=ggplot(all_max_frags[no_fragments<=15 & gene!='SARS2'],\n       aes(factor(no_fragments),max_fragment_length))+\n  geom_boxplot(lwd=2,col='darkgrey')+\n  scale_x_discrete('Number of Fragments')+\n  scale_y_continuous('Length of Longest Fragment')+\n  geom_segment(aes(x = max_rs[virus=='WIV1']$no_fragments,\n                   xend = max_rs[virus=='rWIV1']$no_fragments*0.99,\n                   y=max_rs[virus=='WIV1']$max_fragment_length,\n                   yend = max_rs[virus=='rWIV1']$max_fragment_length*1.1),\n               arrow = arrow(length = unit(0.5, \"cm\")),lwd=1.5,color=cls[1])+\n  geom_segment(aes(x = max_rs[virus=='MERS']$no_fragments,\n                   xend = max_rs[virus=='rMERS']$no_fragments*0.99,\n                   y=max_rs[virus=='MERS']$max_fragment_length,\n                   yend = max_rs[virus=='rMERS']$max_fragment_length*1.1),\n               arrow = arrow(length = unit(0.5, \"cm\")),lwd=1.5,color=cls[3])+\n  geom_point(data=max_rs,aes(color=virus),cex=7)+\n  scale_color_manual(values=c('black',cls[3],NA,cls[1]))+\n  theme(legend.position=c(.8,.8))+\n  ggtitle('Fingerprint of Golden Gate Assembly')\n\n\nggarrange(ggarrange(g_mers_rs,g_wiv_rs,nrow=2,align = 'v',labels=c('A','B')),\n          g_Ln,ncol=2,widths=c(1.5,3),labels=c(NA,'C'))\nggsave('figures/fingerprint_of_GG_assembly.png',height=8,width=18)\n",
    "created" : 1664898572391.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "4069832331",
    "id" : "170071E0",
    "lastKnownWriteTime" : 1664925226,
    "last_content_update" : 1664925226506,
    "path" : "~/COVID/Origins/RestrictionSites/SARS2_Reverse_Genetics/scripts/Engineered_CoVs.R",
    "project_path" : "scripts/Engineered_CoVs.R",
    "properties" : {
        "tempName" : "Untitled2"
    },
    "relative_order" : 5,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}